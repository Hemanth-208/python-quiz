<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CyberTeam - Master Control</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --blue: #00f3ff; --green: #00ff41; --pink: #ff00ff; --bg: #05080a; }
        body { font-family: 'Courier New', monospace; background: var(--bg); color: #fff; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 95%; max-width: 700px; border: 2px solid var(--blue); padding: 25px; background: rgba(0,0,0,0.95); box-shadow: 0 0 20px var(--blue); }
        .btn { background: transparent; color: var(--blue); border: 1px solid var(--blue); padding: 12px; cursor: pointer; width: 100%; margin: 8px 0; text-transform: uppercase; font-family: inherit; }
        .btn:hover:not(:disabled) { background: var(--blue); color: #000; box-shadow: 0 0 10px var(--blue); }
        .input-f { width: 100%; padding: 15px; background: transparent; border: 1px solid var(--green); color: var(--green); margin: 10px 0; outline: none; font-family: inherit; box-sizing: border-box; }
        .hidden { display: none; }
        .score-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #222; color: var(--green); }
        .rank-1 { color: gold; font-weight: bold; text-shadow: 0 0 10px gold; }
        #q-text { margin: 20px 0; font-size: 1.2em; border-left: 3px solid var(--pink); padding-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div id="start-menu">
        <h2 style="color:var(--blue); text-align:center;">[ SYSTEM_ACCESS ]</h2>
        <button class="btn" onclick="showCreate()">Host as Creator</button>
        <button class="btn" onclick="showJoin()">Join as Player</button>
    </div>

    <div id="create-screen" class="hidden">
        <h2 style="color:var(--blue)">Setup Console</h2>
        <input type="text" id="c-name" class="input-f" placeholder="YOUR NAME (CREATOR)">
        <button class="btn" onclick="createTeam()">Create Room</button>
    </div>

    <div id="join-screen" class="hidden">
        <h2 style="color:var(--blue)">Sync Link</h2>
        <input type="text" id="room-id" class="input-f" placeholder="4-DIGIT CODE">
        <input type="text" id="p-name" class="input-f" placeholder="YOUR NAME">
        <button class="btn" onclick="joinTeam()">Join Quiz</button>
    </div>

    <div id="lobby-screen" class="hidden">
        <h3 id="display-host"></h3>
        <p>ROOM CODE: <span id="display-code" style="color:var(--pink); font-size:2em"></span></p>
        <div id="player-list" style="margin:20px 0; border:1px dashed #444; padding:10px;"></div>
        <button id="start-btn" class="btn hidden" onclick="startQuiz()">ACTIVATE MISSION</button>
    </div>

    <div id="quiz-screen" class="hidden">
        <div id="role-info" style="color:var(--pink); font-size:0.8em"></div>
        <div id="q-text"></div>
        <div id="interaction-zone"></div>
        <div id="live-leaderboard" style="margin-top:30px; border-top:1px solid var(--blue); padding-top:15px"></div>
    </div>

    <div id="result-screen" class="hidden">
        <h2 style="color:var(--blue); text-align:center;">[ MISSION_END ]</h2>
        <div id="final-stats"></div>
        <button class="btn" onclick="location.reload()">Reset</button>
    </div>
</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyB-EQmy86TNealf_VZB32H3p-bWSyDNE9k",
  authDomain: "cyberquizsync.firebaseapp.com",
  projectId: "cyberquizsync",
  storageBucket: "cyberquizsync.firebasestorage.app",
  messagingSenderId: "241572824298",
  appId: "1:241572824298:web:8941756bda23f03af8c393",
  measurementId: "G-WRS1YXN3T2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let roomCode = "";
let myName = "";
let isHost = false;

const questions = [
    {q: "Which component is known as the brain of the computer?", o: ["RAM", "Hard Disk", "CPU", "Monitor"], a: 2},
    {q: "Which memory is volatile?", o: ["ROM", "RAM", "SSD", "HDD"], a: 1},
    {q: "What does HTTP stand for?", o: ["Hyper Text Transfer Protocol", "High Text Transfer Protocol", "Hyper Transfer Text Process", "Hyper Tool Transfer Protocol"], a: 0},
    {q: "Which device converts digital signals to analog?", o: ["Router", "Modem", "Switch", "Hub"], a: 1},
    {q: "Which of the following is an input device?", o: ["Printer", "Plotter", "Scanner", "Speaker"], a: 2},
    {q: "Shortcut key to copy text in Windows?", o: ["Ctrl + V", "Ctrl + C", "Ctrl + X", "Ctrl + Z"], a: 1},
    {q: "Full form of CPU is:", o: ["Central Processing Unit", "Computer Processing Unit", "Central Program Unit", "Control Processing Unit"], a: 0},
    {q: "Which of the following is system software?", o: ["MS Excel", "Windows OS", "Photoshop", "Chrome"], a: 1},
    {q: "Number system used by computers internally?", o: ["Decimal", "Octal", "Binary", "Hexadecimal"], a: 2},
    {q: "Which part temporarily stores data/instructions?", o: ["Cache", "ROM", "RAM", "Hard Disk"], a: 2},
    {q: "File extension used for Excel files?", o: [".docx", ".xlsx", ".pptx", ".txt"], a: 1},
    {q: "What is the function of an operating system?", o: ["Compile programs", "Manage hardware/software resources", "Create documents", "Browse internet"], a: 1},
    {q: "Which key is used to refresh a webpage?", o: ["F1", "F2", "F5", "F10"], a: 2},
    {q: "Which of the following is NOT a programming language?", o: ["Python", "Java", "HTML", "Oracle"], a: 3},
    {q: "Which storage device has the fastest access time?", o: ["Hard Disk", "CD-ROM", "SSD", "Floppy Disk"], a: 2},
    {q: "What does URL stand for?", o: ["Uniform Resource Locator", "Universal Resource Link", "Unique Reference Location", "Unified Resource Link"], a: 0},
    {q: "What is used to protect a computer from viruses?", o: ["Firewall", "Antivirus", "Router", "Modem"], a: 1},
    {q: "Topology connecting all devices to a central hub?", o: ["Ring", "Bus", "Star", "Mesh"], a: 2},
    {q: "What is the full form of USB?", o: ["Universal System Bus", "Unique Serial Bus", "Universal Serial Bus", "Unified Service Bus"], a: 2},
    {q: "Example of cloud storage?", o: ["Pen Drive", "Google Drive", "DVD", "Hard Disk"], a: 1}
];

function hide() { ['start-menu','create-screen','join-screen','lobby-screen','quiz-screen','result-screen'].forEach(id => document.getElementById(id).classList.add('hidden')); }
function showCreate() { hide(); document.getElementById('create-screen').classList.remove('hidden'); }
function showJoin() { hide(); document.getElementById('join-screen').classList.remove('hidden'); }

function createTeam() {
    myName = document.getElementById('c-name').value.trim();
    if(!myName) return;
    roomCode = Math.floor(1000 + Math.random() * 9000).toString();
    isHost = true;
    db.ref('rooms/' + roomCode).set({ status: 'lobby', currentQ: 0, creator: myName });
    initSync();
}

function joinTeam() {
    roomCode = document.getElementById('room-id').value.trim();
    myName = document.getElementById('p-name').value.trim();
    if(!roomCode || !myName) return;
    db.ref(`rooms/${roomCode}/players/${myName}`).set({ points: 0 });
    initSync();
}

function initSync() {
    db.ref('rooms/' + roomCode).on('value', (snap) => {
        const data = snap.val();
        if(!data) return;
        
        if(data.status === 'lobby') {
            hide(); document.getElementById('lobby-screen').classList.remove('hidden');
            document.getElementById('display-host').innerText = `HOST: ${data.creator}`;
            document.getElementById('display-code').innerText = roomCode;
            let list = `<strong>SYNCED USERS:</strong>`;
            for(let p in data.players) { list += `<div>[PLAYER] ${p}</div>`; }
            document.getElementById('player-list').innerHTML = list;
            if(isHost) document.getElementById('start-btn').classList.remove('hidden');
        }

        if(data.status === 'playing') {
            hide(); document.getElementById('quiz-screen').classList.remove('hidden');
            const q = questions[data.currentQ];
            document.getElementById('q-text').innerText = `Q${data.currentQ+1}: ${q.q}`;
            document.getElementById('role-info').innerText = isHost ? "CREATOR MODE: VIEWING PROGRESS" : `PLAYER: ${myName}`;

            if(!isHost) {
                let opts = "";
                q.o.forEach((o, i) => { opts += `<button class="btn" onclick="checkAns(${i}, ${data.currentQ})">${o}</button>`; });
                document.getElementById('interaction-zone').innerHTML = opts;
            } else {
                document.getElementById('interaction-zone').innerHTML = "<p style='color:var(--green)'>Live sorting leaderboard below...</p>";
            }

            let scores = [];
            for(let p in data.players) { scores.push({name: p, pts: data.players[p].points}); }
            scores.sort((a,b) => b.pts - a.pts);
            let html = "<strong>LIVE RANKINGS:</strong>";
            scores.forEach((s, i) => {
                html += `<div class="score-row ${i === 0 ? 'rank-1' : ''}"><span>#${i+1} ${s.name}</span><span>${s.pts} PTS</span></div>`;
            });
            document.getElementById('live-leaderboard').innerHTML = html;
        }

        if(data.status === 'finished') {
            hide(); document.getElementById('result-screen').classList.remove('hidden');
            let scores = [];
            for(let p in data.players) { scores.push({name: p, pts: data.players[p].points}); }
            scores.sort((a,b) => b.pts - a.pts);
            let html = "";
            scores.forEach((s, i) => {
                html += `<div class="score-row ${i === 0 ? 'rank-1' : ''}"><span>#${i+1} ${s.name}</span><span>${s.pts} PTS</span></div>`;
            });
            document.getElementById('final-stats').innerHTML = html;
        }
    });
}

function startQuiz() { db.ref('rooms/' + roomCode).update({ status: 'playing' }); }

function checkAns(idx, qIdx) {
    if(idx === questions[qIdx].a) {
        db.ref(`rooms/${roomCode}/players/${myName}/points`).transaction(p => (p || 0) + 2);
        if(qIdx + 1 < questions.length) {
            db.ref('rooms/' + roomCode).update({ currentQ: qIdx + 1 });
        } else {
            db.ref('rooms/' + roomCode).update({ status: 'finished' });
        }
    } else {
        alert("INCORRECT.");
    }
}
</script>
</body>
</html>
